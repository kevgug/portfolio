import{d as I}from"./marked-13f94b6b.js";import{e as A}from"./index-b40a4f3c.js";function X(k,a,y){var G,J;const n=k.split(/\r?\n/);let t=0;if(((G=n[t])==null?void 0:G.trim())==="---"){for(t++;t<n.length&&((J=n[t])==null?void 0:J.trim())!=="---";)t++;t++}for(;t<n.length&&n[t].trim()==="";)t++;const f=a||(()=>{const l=n[t]||"";return t++,l.replace(/^#\s*/,"").trim()})(),B=y||(()=>{for(;t<n.length&&n[t].trim()==="";)t++;return(n[t]||"").trim()})(),p=f,E=B;if(a||t++,!y){for(;t<n.length&&n[t].trim()==="";)t++;t++}const _=[],F={};let q="",i=null,N=!1,L=[],R=!1,z="",D=[],H=!1,O=[],T=!1,r=[],S=!1,b=[],W=!1,w=[],m=!1,d=[];const g=()=>{if(L.length>0){const l=L.some(o=>o.endsWith("\\"));let e;if(l?e=L.map(o=>o.endsWith("\\")?o.slice(0,-1).trim():o.trim()).join("<br>").trim():e=L.join(" ").trim(),e){const o={type:"paragraph",tokens:V(e)};i?i.content.push(o):m||d.push(o)}}L=[]},$=()=>{if(r.length>0){const l={type:"list",items:r.map(e=>V(e))};i?i.content.push(l):m||d.push(l)}r=[],T=!1},M=()=>{if(b.length>0){const l=b.some(c=>c.endsWith("\\"));let e,o,h=!1;l?(h=b[b.length-1].endsWith("\\"),e=b.map(u=>{const P=u.endsWith("\\")?u.slice(0,-1).trim():u;return`<span class="blockquote-line">${I.parseInline(P)}</span>`}).join("").trim(),o=!0):(e=I.parseInline(b.join(" ")),o=!1);const x={type:"blockquote",text:e,multiline:o,endsWithBreak:h};i?i.content.push(x):m||d.push(x)}b=[],S=!1},C=()=>{if(w.length>=3){const l=x=>{const c=x.split("|").map(u=>u.trim());return c[0]===""&&c.shift(),c.length>0&&c[c.length-1]===""&&c.pop(),c},e=l(w[0]),o=w.slice(2).map(x=>l(x)),h={type:"table",headers:e,rows:o};i?i.content.push(h):m||d.push(h)}w=[],W=!1};for(;t<n.length;t++){const l=n[t]??"",e=l.replace(/\t/g,"    ");if(R){if(e.trim()==="```"){const s={type:"code",lang:z,code:D.join(`
`)};i?i.content.push(s):m||d.push(s),R=!1,D=[],z=""}else D.push(l);continue}if(H){if(e.trim()==="$$"){const s={type:"latex",latex:O.join(`
`)};i?i.content.push(s):m||d.push(s),H=!1,O=[]}else O.push(e);continue}const o=e.match(/^```(\w*)/);if(o){g(),$(),M(),C(),R=!0,z=o[1]||"";continue}if(e.trim()==="$$"){g(),$(),M(),C(),H=!0;continue}const h=e.match(/^\s*!\[([^\]]*)\]\(([^)]+)\)\s*$/);if(h){g(),$(),M(),C();const s=(h[1]||"").trim(),j=(h[2]||"").trim();let v;if(t+1<n.length){const U=(n[t+1]??"").match(/^\s*[*_](.+)[*_]\s*$/);U&&(v=(U[1]||"").trim(),t++)}const Q={type:"image",path:j,alt:s||j,caption:v};i?i.content.push(Q):m||d.push(Q);continue}const x=e.match(/^##\s+(.*)$/);if(x){g(),$(),M(),C();const s=(x[1]||"").trim();N=/^notes$/i.test(s),N?i=null:(m=!0,i={heading:s,content:[]},_.push(i));continue}if(N){const s=e.match(/^\[(\d+)\]\s*(.*)$/);if(s){const j=s[1],v=(s[2]||"").trim();j&&(F[j]=I.parseInline(v))}else e.trim()&&(q&&(q+=`
`),q+=e);continue}const c=e.match(/^\s*(?:-|\*|\+)\s+(.*)/);if(c){T||(g(),T=!0),r.push((c[1]||"").trim());continue}const u=e.match(/^\s{2,}(.*)/);if(T&&u&&(u[1]||"").trim()&&r.length>0){const s=r[r.length-1];s.endsWith("\\")?r[r.length-1]=s.slice(0,-1).trim()+"<br>"+(u[1]||"").trim():r[r.length-1]+=" "+(u[1]||"").trim();continue}T&&$();const P=e.match(/^>\s*(.*)$/);if(P){S||(g(),S=!0),b.push((P[1]||"").trim());continue}S&&M();const K=e.match(/^\s*\|.*\|\s*$/);if(K&&t+1<n.length){const s=n[t+1]??"";if(/^\s*\|[\s\-:|]+\|\s*$/.test(s)){W||(g(),$(),W=!0),w.push(e.trim());continue}}if(W&&K){w.push(e.trim());continue}if(W&&C(),e.trim()===""){g();continue}L.push(e.trim())}return g(),$(),M(),C(),!m&&d.length>0&&_.push({heading:p,content:d}),{title:p,date:E,sections:_,footnotes:F,contributionNote:q?I.parse(q):void 0}}function V(k){const a=[],y=new RegExp("(\\[\\d+\\])|(?<!\\\\)\\$\\$([^\\n]+?)\\$\\$","g");let n=0,t;for(;t=y.exec(k);){const f=t.index,B=f+t[0].length;if(f>n){const p=k.slice(n,f);a.push({type:"text",text:I.parseInline(p)})}if(t[1]){const p=t[1].match(/\[(\d+)\]/);p&&a.push({type:"ref",num:p[1]})}else t[2]&&a.push({type:"latex",latex:t[2]});n=B}return n<k.length&&a.push({type:"text",text:I.parseInline(k.slice(n))}),a}const Y=async({params:k,fetch:a})=>{const{slug:y}=k,n=await a("/essays/index.json");if(!n.ok)throw A(404,"Essay not found");const f=(await n.json()).find(_=>_.slug===y);if(!f)throw A(404,"Essay not found");const B=await a(`/essays/${y}.md`);if(!B.ok)throw A(404,"Essay not found");const p=await B.text(),E=X(p,f.title,f.date);return{slug:y,post:E,publish:f.publish}},nt=Object.freeze(Object.defineProperty({__proto__:null,load:Y},Symbol.toStringTag,{value:"Module"}));export{nt as _,Y as l};
