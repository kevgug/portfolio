const T=/\[(\d+)\]/g;function M(s,i,n){var g,d;const e=s.split(/\r?\n/);let t=0;if(((g=e[t])==null?void 0:g.trim())==="---"){for(t++;t<e.length&&((d=e[t])==null?void 0:d.trim())!=="---";)t++;t++}for(;t<e.length&&e[t].trim()==="";)t++;const l=i||(()=>{const a=e[t]||"";return t++,a.replace(/^#\s*/,"").trim()})(),E=n||(()=>{for(;t<e.length&&e[t].trim()==="";)t++;return(e[t]||"").trim()})(),F=l,k=E;if(i||t++,!n){for(;t<e.length&&e[t].trim()==="";)t++;t++}const u=[],m={};let o=null,h=!1,p=[];const f=()=>{const a=p.join(" ").trim();a&&o&&o.paragraphs.push(a),p=[]};for(;t<e.length;t++){const c=(e[t]??"").replace(/\t/g,"    "),x=c.match(/^##\s+(.*)$/);if(x){f();const r=(x[1]||"").trim();h=/^notes$/i.test(r),h?o=null:(o={heading:r,paragraphs:[]},u.push(o));continue}if(h){const r=c.match(/^\[(\d+)\]\s*(.*)$/);if(r){const w=r[1],y=(r[2]||"").trim();w&&(m[w]=y)}continue}if(c.trim()===""){f();continue}p.push(c.trim())}return f(),{title:F,date:k,sections:u,footnotes:m}}function O(s){const i=[];let n=0,e;for(T.lastIndex=0;e=T.exec(s);){const t=e.index,l=t+e[0].length;t>n&&i.push({type:"text",text:s.slice(n,t)}),i.push({type:"ref",num:e[1]}),n=l}return n<s.length&&i.push({type:"text",text:s.slice(n)}),i}export{M as p,O as t};
