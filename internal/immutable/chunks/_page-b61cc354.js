import{d as _}from"./marked-c7288604.js";import{e as F}from"./index-b40a4f3c.js";function X(y,a,b){var J,K;const n=y.split(/\r?\n/);let t=0;if(((J=n[t])==null?void 0:J.trim())==="---"){for(t++;t<n.length&&((K=n[t])==null?void 0:K.trim())!=="---";)t++;t++}for(;t<n.length&&n[t].trim()==="";)t++;const f=a||(()=>{const l=n[t]||"";return t++,l.replace(/^#\s*/,"").trim()})(),L=b||(()=>{for(;t<n.length&&n[t].trim()==="";)t++;return(n[t]||"").trim()})(),p=f,v=L;if(a||t++,!b){for(;t<n.length&&n[t].trim()==="";)t++;t++}const T=[],G={};let I="",i=null,N=!1,w=[],z=!1,D="",H=[],O=!1,A=[],q=!1,r=[],P=!1,$=[],W=!1,M=[],m=!1,d=[];const g=()=>{if(w.length>0){const l=w.some(o=>o.endsWith("\\"));let e;if(l?e=w.map(o=>o.endsWith("\\")?o.slice(0,-1).trim():o.trim()).join("<br>").trim():e=w.join(" ").trim(),e){const o={type:"paragraph",tokens:V(e)};i?i.content.push(o):m||d.push(o)}}w=[]},B=()=>{if(r.length>0){const l={type:"list",items:r.map(e=>V(e))};i?i.content.push(l):m||d.push(l)}r=[],q=!1},C=()=>{if($.length>0){const l=$.some(c=>c.endsWith("\\"));let e,o,h=!1;l?(h=$[$.length-1].endsWith("\\"),e=$.map(u=>{const R=u.endsWith("\\")?u.slice(0,-1).trim():u;return`<span class="blockquote-line">${_.parseInline(R)}</span>`}).join("").trim(),o=!0):(e=_.parseInline($.join(" ")),o=!1);const x={type:"blockquote",text:e,multiline:o,endsWithBreak:h};i?i.content.push(x):m||d.push(x)}$=[],P=!1},j=()=>{if(M.length>=3){const l=x=>{const c=x.split("|").map(u=>u.trim());return c[0]===""&&c.shift(),c.length>0&&c[c.length-1]===""&&c.pop(),c},e=l(M[0]),o=M.slice(2).map(x=>l(x)),h={type:"table",headers:e,rows:o};i?i.content.push(h):m||d.push(h)}M=[],W=!1};for(;t<n.length;t++){const l=n[t]??"",e=l.replace(/\t/g,"    ");if(z){if(e.trim()==="```"){const s={type:"code",lang:D,code:H.join(`
`)};i?i.content.push(s):m||d.push(s),z=!1,H=[],D=""}else H.push(l);continue}if(O){const s=e.trim().match(/^\$\$(?:\s*\[(\d+)\])?$/);if(s){const k=s[1],E={type:"latex",latex:A.join(`
`).replace(/\\_/g,"_"),...k&&{footnoteRef:k}};i?i.content.push(E):m||d.push(E),O=!1,A=[]}else A.push(e);continue}const o=e.match(/^```(\w*)/);if(o){g(),B(),C(),j(),z=!0,D=o[1]||"";continue}if(e.trim()==="$$"){g(),B(),C(),j(),O=!0;continue}const h=e.match(/^\s*!\[([^\]]*)\]\(([^)]+)\)\s*$/);if(h){g(),B(),C(),j();const s=(h[1]||"").trim(),k=(h[2]||"").trim();let S;if(t+1<n.length){const U=(n[t+1]??"").match(/^\s*[*_](.+)[*_]\s*$/);U&&(S=(U[1]||"").trim(),t++)}const E={type:"image",path:k,alt:s||k,caption:S};i?i.content.push(E):m||d.push(E);continue}const x=e.match(/^##\s+(.*)$/);if(x){g(),B(),C(),j();const s=(x[1]||"").trim();N=/^notes$/i.test(s),N?i=null:(m=!0,i={heading:s,content:[]},T.push(i));continue}if(N){const s=e.match(/^\[(\d+)\]\s*(.*)$/);if(s){const k=s[1],S=(s[2]||"").trim();k&&(G[k]=_.parseInline(S))}else e.trim()&&(I&&(I+=`
`),I+=e);continue}const c=e.match(/^\s*(?:-|\*|\+)\s+(.*)/);if(c){q||(g(),q=!0),r.push((c[1]||"").trim());continue}const u=e.match(/^\s{2,}(.*)/);if(q&&u&&(u[1]||"").trim()&&r.length>0){const s=r[r.length-1];s.endsWith("\\")?r[r.length-1]=s.slice(0,-1).trim()+"<br>"+(u[1]||"").trim():r[r.length-1]+=" "+(u[1]||"").trim();continue}q&&B();const R=e.match(/^>\s*(.*)$/);if(R){P||(g(),P=!0),$.push((R[1]||"").trim());continue}P&&C();const Q=e.match(/^\s*\|.*\|\s*$/);if(Q&&t+1<n.length){const s=n[t+1]??"";if(/^\s*\|[\s\-:|]+\|\s*$/.test(s)){W||(g(),B(),W=!0),M.push(e.trim());continue}}if(W&&Q){M.push(e.trim());continue}if(W&&j(),e.trim()===""){g();continue}w.push(e.trim())}return g(),B(),C(),j(),!m&&d.length>0&&T.push({heading:p,content:d}),{title:p,date:v,sections:T,footnotes:G,contributionNote:I?_.parse(I):void 0}}function V(y){const a=[],b=new RegExp("(\\[\\d+\\])|(?<!\\\\)\\$\\$([^\\n]+?)\\$\\$","g");let n=0,t;for(;t=b.exec(y);){const f=t.index,L=f+t[0].length;if(f>n){const p=y.slice(n,f);a.push({type:"text",text:_.parseInline(p)})}if(t[1]){const p=t[1].match(/\[(\d+)\]/);p&&a.push({type:"ref",num:p[1]})}else t[2]&&a.push({type:"latex",latex:t[2]});n=L}return n<y.length&&a.push({type:"text",text:_.parseInline(y.slice(n))}),a}const Y=async({params:y,fetch:a})=>{const{slug:b}=y,n=await a("/essays/index.json");if(!n.ok)throw F(404,"Essay not found");const f=(await n.json()).find(T=>T.slug===b);if(!f)throw F(404,"Essay not found");const L=await a(`/essays/${b}.md`);if(!L.ok)throw F(404,"Essay not found");const p=await L.text(),v=X(p,f.title,f.date);return{slug:b,post:v,publish:f.publish}},nt=Object.freeze(Object.defineProperty({__proto__:null,load:Y},Symbol.toStringTag,{value:"Module"}));export{nt as _,Y as l};
