import{d as T}from"./marked-c7288604.js";import{e as G}from"./index-b40a4f3c.js";function Z(k,r,y){var K,Q;const n=k.split(/\r?\n/);let t=0;if(((K=n[t])==null?void 0:K.trim())==="---"){for(t++;t<n.length&&((Q=n[t])==null?void 0:Q.trim())!=="---";)t++;t++}for(;t<n.length&&n[t].trim()==="";)t++;const f=r||(()=>{const l=n[t]||"";return t++,l.replace(/^#\s*/,"").trim()})(),w=y||(()=>{for(;t<n.length&&n[t].trim()==="";)t++;return(n[t]||"").trim()})(),p=f,N=w;if(r||t++,!y){for(;t<n.length&&n[t].trim()==="";)t++;t++}const q=[],J={};let W="",i=null,O=!1,M=[],z=!1,D="",H=[],A=!1,F=[],$=!1,a=[],R=!1,v=!1,b=[],S=!1,C=[],m=!1,d=[];const h=()=>{if(M.length>0){const l=M.some(o=>o.endsWith("\\"));let e;if(l?e=M.map(o=>o.endsWith("\\")?o.slice(0,-1).trim():o.trim()).join("<br>").trim():e=M.join(" ").trim(),e){const o={type:"paragraph",tokens:Y(e)};i?i.content.push(o):m||d.push(o)}}M=[]},B=()=>{if(a.length>0){const l={type:"list",ordered:R,items:a.map(e=>Y(e))};i?i.content.push(l):m||d.push(l)}a=[],$=!1,R=!1},j=()=>{if(b.length>0){const l=b.some(c=>c.endsWith("\\"));let e,o,u=!1;l?(u=b[b.length-1].endsWith("\\"),e=b.map(L=>{const I=L.endsWith("\\")?L.slice(0,-1).trim():L;return`<span class="blockquote-line">${T.parseInline(I)}</span>`}).join("").trim(),o=!0):(e=T.parseInline(b.join(" ")),o=!1);const g={type:"blockquote",text:e,multiline:o,endsWithBreak:u};i?i.content.push(g):m||d.push(g)}b=[],v=!1},_=()=>{if(C.length>=3){const l=g=>{const c=g.split("|").map(L=>L.trim());return c[0]===""&&c.shift(),c.length>0&&c[c.length-1]===""&&c.pop(),c},e=l(C[0]),o=C.slice(2).map(g=>l(g)),u={type:"table",headers:e,rows:o};i?i.content.push(u):m||d.push(u)}C=[],S=!1};for(;t<n.length;t++){const l=n[t]??"",e=l.replace(/\t/g,"    ");if(z){if(e.trim()==="```"){const s={type:"code",lang:D,code:H.join(`
`)};i?i.content.push(s):m||d.push(s),z=!1,H=[],D=""}else H.push(l);continue}if(A){const s=e.trim().match(/^\$\$(?:\s*\[(\d+)\])?$/);if(s){const x=s[1],P={type:"latex",latex:F.join(`
`).replace(/\\_/g,"_"),...x&&{footnoteRef:x}};i?i.content.push(P):m||d.push(P),A=!1,F=[]}else F.push(e);continue}const o=e.match(/^```(\w*)/);if(o){h(),B(),j(),_(),z=!0,D=o[1]||"";continue}if(e.trim()==="$$"){h(),B(),j(),_(),A=!0;continue}const u=e.match(/^\s*!\[([^\]]*)\]\(([^)]+)\)\s*$/);if(u){h(),B(),j(),_();const s=(u[1]||"").trim(),x=(u[2]||"").trim();let E;if(t+1<n.length){const X=(n[t+1]??"").match(/^\s*[*_](.+)[*_]\s*$/);X&&(E=(X[1]||"").trim(),t++)}const P={type:"image",path:x,alt:s||x,caption:E};i?i.content.push(P):m||d.push(P);continue}const g=e.match(/^##\s+(.*)$/);if(g){h(),B(),j(),_();const s=(g[1]||"").trim();O=/^notes$/i.test(s),O?i=null:(m=!0,i={heading:s,content:[]},q.push(i));continue}if(O){const s=e.match(/^\[(\d+)\]\s*(.*)$/);if(s){const x=s[1],E=(s[2]||"").trim();x&&(J[x]=T.parseInline(E))}else e.trim()&&(W&&(W+=`
`),W+=e);continue}const c=e.match(/^\s*(?:-|\*|\+)\s+(.*)/);if(c){$||(h(),$=!0,R=!1),a.push((c[1]||"").trim());continue}const L=e.match(/^\s*\d+\.\s+(.*)/);if(L){$||(h(),$=!0,R=!0),a.push((L[1]||"").trim());continue}const I=e.match(/^\s{2,}(.*)/);if($&&I&&(I[1]||"").trim()&&a.length>0){const s=a[a.length-1];s.endsWith("\\")?a[a.length-1]=s.slice(0,-1).trim()+"<br>"+(I[1]||"").trim():a[a.length-1]+=" "+(I[1]||"").trim();continue}$&&B();const U=e.match(/^>\s*(.*)$/);if(U){v||(h(),v=!0),b.push((U[1]||"").trim());continue}v&&j();const V=e.match(/^\s*\|.*\|\s*$/);if(V&&t+1<n.length){const s=n[t+1]??"";if(/^\s*\|[\s\-:|]+\|\s*$/.test(s)){S||(h(),B(),S=!0),C.push(e.trim());continue}}if(S&&V){C.push(e.trim());continue}if(S&&_(),e.trim()===""){h();continue}M.push(e.trim())}return h(),B(),j(),_(),!m&&d.length>0&&q.push({heading:p,content:d}),{title:p,date:N,sections:q,footnotes:J,contributionNote:W?T.parse(W):void 0}}function Y(k){const r=[],y=new RegExp("(\\[\\d+\\])|(?<!\\\\)\\$\\$([^\\n]+?)\\$\\$","g");let n=0,t;for(;t=y.exec(k);){const f=t.index,w=f+t[0].length;if(f>n){const p=k.slice(n,f);r.push({type:"text",text:T.parseInline(p)})}if(t[1]){const p=t[1].match(/\[(\d+)\]/);p&&r.push({type:"ref",num:p[1]})}else t[2]&&r.push({type:"latex",latex:t[2]});n=w}return n<k.length&&r.push({type:"text",text:T.parseInline(k.slice(n))}),r}const tt=async({params:k,fetch:r})=>{const{slug:y}=k,n=await r("/essays/index.json");if(!n.ok)throw G(404,"Essay not found");const f=(await n.json()).find(q=>q.slug===y);if(!f)throw G(404,"Essay not found");const w=await r(`/essays/${y}.md`);if(!w.ok)throw G(404,"Essay not found");const p=await w.text(),N=Z(p,f.title,f.date);return{slug:y,post:N,publish:f.publish}},it=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));export{it as _,tt as l};
